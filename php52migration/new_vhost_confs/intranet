<VirtualHost ***REMOVED***:443>
        SetEnv APPLICATION_ENVIRONMENT production
        ServerName intranet.***REMOVED***.com
        ServerAdmin webmaster@***REMOVED***.com
        <IfModule !mod_php5.c>
          Use php52 intranet
        </IfModule>


        DocumentRoot /***REMOVED***/www/intranet

        <Directory "/***REMOVED***/www/intranet/">
            Options -Indexes FollowSymLinks
            Order deny,allow
            Deny from all

                        AuthName "Please enter user name 'cognoweb' and the external password"
                        AuthUserFile /***REMOVED***/secure/intranet/apache.passwords
                        AuthType Basic
                        Require valid-user
                        Satisfy Any

            Allow from 127
            Allow from ***REMOVED***.0/24

            # Cognolink office
            Allow from 93.97.44.249
            Allow from 77.107.84.74
            Allow from 77.107.84.75
            Allow from 77.107.84.76
            Allow from 77.107.84.77
            Allow from 77.107.84.78
            Allow from 46.65.48.58
            Allow from 46.65.48.88

            # Shanghai office
            Allow from 210.13.65.2
            Allow from 58.246.18.114

            # New York Office
            Allow from 64.115.119.146
            Allow from 64.115.119.147
            Allow from 108.41.24.57

            # IntelliSMS
            Allow from 94.236.49.202

            # Test
            Allow from ***REMOVED***
            Allow from 92.52.113.226
            Allow from ***REMOVED***
            Allow from 92.52.113.231

            # Live
            Allow from ***REMOVED***
            Allow from 92.52.113.225
            Allow from ***REMOVED***
            Allow from 92.52.113.224

            # Monitoring
            Allow from 172.31.0.229
            Allow from 92.52.113.229

            # HK proxy
            Allow from 180.150.141.104

            # HK office
            Allow from 203.198.131.48

            # New Delhi
            Allow from 182.73.68.178
            Allow from 182.73.80.17

            DirectoryIndex index.php index.html
            AllowOverride All
        </Directory>
                <Directory "/***REMOVED***/www/intranet/config">
                        Deny from all
                </Directory>

        <Directory "/***REMOVED***/www/intranet/emailer">
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !main.php
                RewriteRule (.*) main.php [QSA]
        </Directory>

        <Directory "/***REMOVED***/www/intranet/sms">
            RewriteEngine On
            RewriteCond %{REQUEST_FILENAME} !main.php
            RewriteRule (.*) main.php [QSA]
        </Directory>

         <Directory "/***REMOVED***/www/intranet/umg">
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !main.php
                RewriteRule (.*) main.php [QSA]
        </Directory>

        <Directory "/***REMOVED***/www/intranet/massmailer">
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !main.php
                RewriteRule (.*) main.php [QSA]
        </Directory>

        <Directory "/***REMOVED***/www/intranet/mailqueue">
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !main.php
                RewriteRule (.*) main.php [QSA]
        </Directory>

        <Directory "/***REMOVED***/www/intranet/fieldset_handler">
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !main.php
                RewriteRule (.*) main.php [QSA]
        </Directory>

        <Directory "/***REMOVED***/www/intranet/project">
		RewriteEngine On
		RewriteCond %{REQUEST_FILENAME} !main.php
		RewriteRule (.*) main.php [QSA]
        </Directory>

        <Directory "/***REMOVED***/www/intranet/company_finder">
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !main.php
                RewriteRule (.*) main.php [QSA]
        </Directory>

        <Directory "/***REMOVED***/www/intranet/offspring">
                RewriteEngine On
                RewriteCond %{REQUEST_FILENAME} !main.php
                RewriteRule (.*) main.php [QSA]
        </Directory>  

	<IfModule mod_ssl.c>
	        SSLEngine On
	        SSLProtocol -ALL +SSLv3 +TLSv1
	        SSLCipherSuite ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:!MEDIUM
			SSLCertificateFile /etc/ssl/certs/***REMOVED***_wildcard.pem
            SSLCertificateKeyFile /etc/ssl/private/***REMOVED***_wildcard.key
            SSLCertificateChainFile /etc/ssl/certs/geotrust-intermediate.crt

                <Files ~ "\.(***REMOVED***i|shtml|phtml|php?)$">
                        SSLOptions +StdEnvVars
                </Files>
                <Directory "/usr/lib/***REMOVED***i-bin">
                        SSLOptions +StdEnvVars
                </Directory>
                SetEnvIf User-Agent ".*MSIE.*" \
                        nokeepalive ssl-unclean-shutdown \
                        downgrade-1.0 force-response-1.0
	</IfModule>

	<IfModule mod_gnutls.c>
		GnuTLSEnable On
		GnuTLSSessionTickets On
		GnuTLSExportCertificates on
		GnuTLSPriorities SECURE
		GnuTLSCertificateFile /etc/ssl/certs/***REMOVED***_wildcard.pem
		GnuTLSKeyFile /etc/ssl/private/***REMOVED***_wildcard.key
		GnuTLSClientCAFile /etc/ssl/certs/geotrust-intermediate.crt
	</IfModule>

        ErrorLog /***REMOVED***/log/intranet/error_log
        TransferLog /***REMOVED***/log/intranet/access_log
</VirtualHost>

<VirtualHost *:80>
        ServerAdmin webmaster@***REMOVED***.com
        ServerName intranet.***REMOVED***.com
        DocumentRoot /***REMOVED***/www/intranet/

        RewriteEngine On
        RewriteCond %{SERVER_PORT} !443
        RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
</VirtualHost>
